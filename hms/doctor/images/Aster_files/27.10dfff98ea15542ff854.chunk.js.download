(window.webpackJsonp=window.webpackJsonp||[]).push([[27,28],{131:function(e,o,r){(function(o){e.exports=angular.module("webconnect.forgotUserName").controller("forgotUserNameController",["vcRecaptchaService","$routeParams","$rootScope","$modal","$q","$window","$scope","$http","$rootElement","$location","userService","ConfigurationHolder","$filter","utilityService","localStorageService","downloadStatusService","$translate","confirmBoxService","notificationService","OAuthAccountResponse","signupService","patientPortalAppointmentService","languageFetchService","telecomHelperService",function(e,r,t,s,n,a,i,c,u,l,d,f,p,m,g,h,b,w,P,S,v,O,N,T){(i.model={key:f.captchaKey},i.setResponse=function(e){i.response=e},i.setWidgetId=function(e){i.widgetId=e},i.genderList=[],f.serverConfig)?f.serverConfig.availableGenderListPatient.forEach((function(e){i.genderList.push(e.value)})):O.renderWithoutLoginConfigList().then((function(e){f.serverConfig=e.configList,f.serverConfig.availableGenderListPatient.forEach((function(e){i.genderList.push(e.value)}))}));i.forgotUserNameObj={},i.signupDisplayFields={},i.errors={},i.forgotUserNameObj.contactType=f.forgotUserName.defaultContactType,i.currentScreen=0,i.displayFields={},i.maxDate=moment(),i.errorMap={},i.validateDateOfBirth=function(e){e&&o.trim(e)&&v.validateDateOfBirth({dob:p("convertDobToUTC")(e)}).success((function(e,o,r,t){i.isBirthdateInvalid="VDOB63"!==e.info[0].code}))},i.convertDOBToUTC=function(e){return e?p("convertDobToUTC")(e):""},i.moveToNextScreen=function(){i.currentScreen++},i.moveToPreviousScreen=function(){i.currentScreen--},i.sendOneTimePasswordOnForgotUserName=function(e,o){var r=i.forgotUserNameObj;i.disableFormAction=!0;var t=v.createCustomHeaderForRequestWithVersion("V2");m.postHTTP(f.baseURL+"/moUser/forgotUserName",r,!0,t).success((function(r){i.disableFormAction=!1;var t=r.info[0];r.success?(U(C(t)),i.contactOnOTPSent="",t.phoneNumber?i.contactOnOTPSent=t.phoneNumber:t.email&&(i.contactOnOTPSent=t.email),i.currentScreen=1):(i.errorMap=t,F(e,o))})).error((function(e,o,r,t){i.disableFormAction=!1,P.error(p("translate")("forgotPassword.otpSentError")),(404==o||422==o||460==o||4041==o&&"461"==e.status||(o=405))&&(i.message=p("translate")("forgotPassword.errorText."+e.status))}))},i.retrieveUserName=function(e,o){var r=i.forgotUserNameObj;i.disableFormAction=!0;var t=v.createCustomHeaderForRequestWithVersion("V2");m.postHTTP(f.baseURL+"/moUser/retrieveUserName",r,!0,t).success((function(r){if(r.success&&r.info&&r.info[0].successHandler){P.success(p("translate")("patientSignUp.otpVerification.otpVerified"));var t=r.info[0].successHandler;y(t)}else F(e,o);i.disableFormAction=!1})).error((function(r){i.errorMap=r.errors[0],F(e,o),i.disableFormAction=!1}))};var y=function(e){if(e){if(v.setSignUpSuccessUriData(e),t.openAuthenticationContainer)return void(t.processTemplatePath="/webconnect/components/forgotUserName/retrievePortalId-successModal.html");l.path("/recoverySuccess")}};i.displaySuccessData=function(){var e=v.getSignUpSuccessUriData();e&&Object.keys(e).length?i.successObj=e:l.path("/auth")},i.setVerifyingMobileNumber=function(e,r,t){r=r&&o.trim(r).length>0&&!r.startsWith("+")?"+"+r:r,e&&(e=r+e,setTimeout((function(){o("#"+t).intlTelInput("setNumber",e)}),0))};var C=function(e){return{isOTPSentOnEmail:e.otpSentOnMail,isOTPSentOnMobile:e.otpSentOnPhone,email:e.email,phoneNumber:e.phoneNumber}},U=function(e){var o=e.isOTPSentOnEmail,r=e.isOTPSentOnMobile,t=e.email,s=e.phoneNumber;o&&r&&t&&t.length>0&&s&&s.length>0?P.success(p("translate")("forgotUserName.otpSuccessMessageBothEmailAndMobile",{emailId:t,phoneNumber:p("formatInternational")(s)})):o&&t&&t.length>0?P.success(p("translate")("forgotUserName.otpSuccessMessageOnlyEmail",{emailId:t})):r&&s&&s.length>0?P.success(p("translate")("forgotUserName.otpSuccessMessageOnlyMobile",{phoneNumber:p("formatInternational")(s)})):P.success(p("translate")("CA.registration.forgotPassword.otpSentSuccessfully"))};function F(e,o){e[o].$setValidity("server",!1)}i.phoneNumberValidation=function(e){var r=o("#"+e);if(i.forgotUserNameObj.countryCode=r.intlTelInput("getSelectedCountryData"),i.forgotUserNameObj.phoneNumber=r.intlTelInput("getNumber"),i.forgotUserNameObj.countryCode="+"+i.forgotUserNameObj.countryCode.dialCode,i.forgotUserNameObj.phoneNumber=i.forgotUserNameObj.phoneNumber.replace(i.forgotUserNameObj.countryCode,""),i.forgotUserNameObj.phoneNumber)return 0==T.customPhoneValidator(r)||0==i.forgotUserNameObj.phoneNumber.length?i.phoneNumberInvalid=!0:i.phoneNumberInvalid=!1,i.phoneNumberInvalid;i.phoneNumberInvalid=!1},i.getUserName=function(){i.username=r.username},i.removeServerErrorFromForm=function(e,o){i.errorMap={},e[o].$setValidity("server",!0)},i.fetchCountries=function(){var e=v.createCustomHeaderForRequestWithVersion("V1"),o={lang:N.getCurrentLanguage()};m.postHTTP(f.baseURL+"/moCountryDropDown/fetchCountries",o,!1,e).success((function(e){e.success&&(i.countriesList=e.countries)}))},i.validateAgainstMinDate=function(e,r,t){if(e&&o.trim(e))return e<t.startOf("day")}}])}).call(this,r(1))},89:function(e,o,r){(function(o){e.exports=angular.module("webconnect.forgotPassword").controller("forgotPasswordController",["vcRecaptchaService","$routeParams","$rootScope","$modal","$q","$window","$scope","$http","$rootElement","$location","userService","ConfigurationHolder","$filter","utilityService","localStorageService","downloadStatusService","$translate","confirmBoxService","notificationService","OAuthAccountResponse","signupService","telecomHelperService",function(e,r,t,s,n,a,i,c,u,l,d,f,p,m,g,h,b,w,P,S,v,O){i.token=r.token,i.otpSentToDevice=null,i.response=null,i.widgetId=null,i.retiresMoreThanThree=!1,i.pageSetUpSuccessFull=!0,i.phoneNumberInvalid=!1,i.validations={phoneNumberInvalid:!1},i.disableForm=!1,i.model={key:f.captchaKey},i.setResponse=function(e){i.response=e},i.setWidgetId=function(e){i.widgetId=e},i.errorMap={},i.fetchSignupConfigs=function(){v.getSignUpConfig().success((function(e,o,r,t){i.configData=e,i.configData.passwordRegex=e.passwordRegex})).error((function(e,o,r,t){i.pageSetUpSuccessFull=!1,i.pageSetUpErrorMessage=p("translate")("patientSignUp.serverError")}))},i.checkNumber=function(e){e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105||13!=e.keyCode&&46!=e.keyCode&&8!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&9!=e.keyCode&&e.preventDefault()},i.loginType=f.signInOptionAllowed.defaultSignIn,i.currentScreen=1,i.forgotPasswordObj={},i.forgotPasswordType=f.forgotPasswordOptionAllowed.defaultForgotPassword,i.resetForgotPasswordForm=function(e){i.forgotPasswordType=e,i.message="",i.phoneNumberInvalid=!1,i.validations.phoneNumberInvalid=!1},i.forgotPassword=function(e,o,r){i.disableForm=!0,i.message="",r&&(i.forgotPasswordObj.otp=null,i.removeServerErrorFromForm(e,o));var t={source:"FORGOT_PASSWORD"};t.baseUrl=f.frontEndURL,"EMAIL"==i.forgotPasswordType?t.email=i.forgotPasswordObj.email:"USERNAME"==i.forgotPasswordType?t.username=i.forgotPasswordObj.username:"MOBILE"==i.forgotPasswordType&&(t.phoneNumber=i.forgotPasswordObj.phoneNo,t.countryCode=i.forgotPasswordObj.countryCode);var s=v.createCustomHeaderForRequestWithVersion("V2");m.postHTTP(f.baseURL+"/moSignUp/sendOneTimePassword",t,!0,s).success((function(t){i.disableForm=!1;var s=t.info[0];if(t.success){if(1==t.info[0].useResetPasswordPinFlow&&N(T(s)),s.otpSentOnPhone&&(i.phoneNoOnOTPsent=s.phoneNumber),!r&&t.info[0].useResetPasswordPinFlow&&i.moveToNextScreen(),0==t.info[0].useResetPasswordPinFlow){p("translate")("forgotPassword.successModalHeader"),p("translate")("forgotPassword.successMessage");i.linkSentSuccessfulModal()}}else i.errorMap=s,y(e,o)})).error((function(e,o,r,t){i.disableForm=!1,P.error(p("translate")("forgotPassword.otpSentError")),(404==o||422==o||460==o||4041==o&&"461"==e.status||(o=405))&&(i.message=p("translate")("forgotPassword.errorText."+e.status))}))},i.showHidePassword=function(e){var r=o(e.target),t=r.next("input");"password"===t.attr("type")?(t.attr("type","text"),r.removeClass("icon-show_password").addClass("icon-hide_password")):(t.attr("type","password"),r.removeClass("icon-hide_password").addClass("icon-show_password"))},i.phoneNumberValidation=function(e){var r=o("#"+e);return i.forgotPasswordObj.countryCode=r.intlTelInput("getSelectedCountryData"),i.forgotPasswordObj.phoneNo=r.intlTelInput("getNumber"),i.forgotPasswordObj.countryCode="+"+i.forgotPasswordObj.countryCode.dialCode,i.forgotPasswordObj.phoneNo=i.forgotPasswordObj.phoneNo.replace(i.forgotPasswordObj.countryCode,""),0==O.customPhoneValidator(r)||0==i.forgotPasswordObj.phoneNo.length?(i.phoneNumberInvalid=!0,i.validations.phoneNumberInvalid=!0):(i.validations.phoneNumberInvalid=!1,i.phoneNumberInvalid=!1),i.phoneNumberInvalid},i.validateOtp=function(e,o){i.disableForm=!0;var r={};r.otp=i.forgotPasswordObj.otp,r.source="FORGOT_PASSWORD","USERNAME"==i.forgotPasswordType?r.username=i.forgotPasswordObj.username:"EMAIL"==i.forgotPasswordType?r.email=i.forgotPasswordObj.email:"MOBILE"==i.forgotPasswordType&&(r.phoneNumber=i.forgotPasswordObj.phoneNo,r.countryCode=i.forgotPasswordObj.countryCode);var t=v.createCustomHeaderForRequestWithVersion("V2");m.postHTTP(f.baseURL+"/moSignUp/verifyOneTimePassword",r,!0,t).success((function(e){i.disableForm=!1,e.success&&(P.success(p("translate")("patientSignUp.otpVerification.otpVerified")),i.moveToNextScreen())})).error((function(r){i.disableForm=!1,i.errorMap=r.errors[0],y(e,o)}))},i.moveToNextScreen=function(){i.currentScreen+=1},i.moveToPreviousScreen=function(){i.currentScreen-=1},i.passwordIsStrongEnough=!0,i.checkForPasswordStrength=function(e){Math.round(e/33)>=parseInt(f.passwordStrengthLevel)?i.passwordIsStrongEnough=!0:i.passwordIsStrongEnough=!1},i.setNewPasswordWithOtp=function(){i.disableForm=!0;var e={};e.otp=i.forgotPasswordObj.otp,e.newPassword=i.forgotPasswordObj.newPassword,e.source="FORGOT_PASSWORD","USERNAME"==i.forgotPasswordType?e.username=i.forgotPasswordObj.username:"EMAIL"==i.forgotPasswordType?e.email=i.forgotPasswordObj.email:"MOBILE"==i.forgotPasswordType&&(e.phoneNumber=i.forgotPasswordObj.phoneNo,e.countryCode=i.forgotPasswordObj.countryCode);var o=v.createCustomHeaderForRequestWithVersion("V2");m.postHTTP(f.baseURL+"/moUser/setNewPasswordWithOtp",e,!0,o).success((function(e){if(i.disableForm=!1,e.success){if(P.success(p("translate")("resetPassword.successMessage")),t.openAuthenticationContainer)return void(t.processTemplatePath="/webconnect/components/forgotPassword/forgotPassword-successModal.html");l.path("/forgotPasswordSuccess")}})).error((function(e,o,r,t){i.disableForm=!1,422==o&&e.errors&&e.errors.length>0&&(i.message=p("translate")("changePassword.errorText."+e.errors[0].code)),404==o&&"ONF"==e.status&&(i.message=p("translate")("forgotPassword.otpValidationFailure")),404==o&&"OPE404"==e.status&&(i.message=p("translate")("forgotPassword.otpValidationExpire")),400==o&&(P.error(p("translate")("changePassword.errorText."+e.status)),i.redirectToDefault()),423==o&&(i.message=p("translate")("changePassword.errorText."+e.status)),P.error(i.message)}))};var N=function(e){var o=e.isOTPSentOnEmail,r=e.isOTPSentOnMobile,t=e.email,s=e.phoneNumber;o&&r&&t&&t.length>0&&s&&s.length>0?P.success(p("translate")("forgotPassword.otpSuccessMessageBothEmailAndMobile",{emailId:t,phoneNumber:p("formatInternational")(s)})):o&&t&&t.length>0?P.success(p("translate")("forgotPassword.otpSuccessMessageOnlyEmail",{emailId:t})):r&&s&&s.length>0?P.success(p("translate")("forgotPassword.otpSuccessMessageOnlyMobile",{phoneNumber:p("maskPhoneNumber")(i.forgotPasswordObj.phoneNo)})):P.success(p("translate")("CA.registration.forgotPassword.otpSentSuccessfully"))},T=function(e){return{isOTPSentOnEmail:e.otpSentOnMail,isOTPSentOnMobile:e.otpSentOnPhone,email:e.email,phoneNumber:e.phoneNumber}};function y(e,o){e[o].$setValidity("server",!1)}i.removeServerErrorFromForm=function(e,o){i.errorMap={},e[o].$setValidity("server",!0)},i.linkSentSuccessfulModal=function(){s.open({templateUrl:"components/forgotPassword/forgotPasswordLinkSentSuccess.html",controller:"ForgotPasswordModalCtrl",scope:i,size:"sm"})}}]).controller("ForgotPasswordModalCtrl",["$scope","$location","$modalInstance","ConfigurationHolder",function(e,o,r,t){e.cancel=function(){r.close()},e.ok=function(){r.close()},e.redirectToAuth=function(){r.close(),o.path(t.logout.redirectUrl)}}])}).call(this,r(1))}}]);