(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{53:function(e,t,i){(function(t){e.exports=angular.module("webconnect.userSignUp").controller("userSignupCtrl",["$rootScope","$scope","signupService","$http","$location","localStorageService","notificationService","userService","ConfigurationHolder","$modal","utilityService","$filter","$routeParams","$q","gtmEventObservableService","tokenService","patientPortalAppointmentService","languageFetchService","telecomHelperService","customLocalStorageService","$route",function(e,i,s,n,o,r,a,c,u,l,p,d,g,m,f,b,F,h,y,O,v){function S(){i.maxDate=moment().toDate(),i.searchMap={},i.errorMap={},i.signupDisplayFields={dobToDisplay:null,isDobValidated:!0,phoneNoToDisplay:""},i.signupObject={},i.signupObject.userFields={},i.signupObject.userFields.userType="PATIENT",i.signupObject.signUpSource="SELF_SIGN_UP_WEB",i.signupObject.userFields.activeResource={status:"ACTIVE"},i.signupObject.userFields.isEmailVerified=!1,i.signupObject.userFields.isPhoneNoVerified=!1,i.signupObject.customFields={},i.signupObject.userFields.disableExistingAccount=!0,i.signupObject.customFields.emergencyContact={},i.signupObject.customFields.passportDetails={},i.maxDate=moment(),i.minDate=moment(u.dobMinDate,"MM/DD/YYYY").toDate(),i.signupObject.customFields.autoLogin=!!i.configData&&i.configData.enableAutoLogin,i.signupDisplayFields={}}var D,U;(i.setSignUpCardActive=function(){if(r.get("saveControllerState")){var e=r.get("savedStateOfApplication");r.set("isSignUpWithFB",!0),o.path(e)}else C(i.configData.signUpProcess),P(0)},e.message="",S(),i.facebookUserData=Object.keys(s.getFacebookUserData()).length>0?s.getFacebookUserData():null,i.addUserFieldsFromFacebookData=function(){i.signupObject.userFields.email=i.facebookUserData.email,i.signupObject.userFields.firstName=i.facebookUserData.firstName,i.signupObject.userFields.lastName=i.facebookUserData.lastName,i.signupDisplayFields.dobToDisplay=i.facebookUserData.birthday;var e=i.facebookUserData.gender.toUpperCase();i.signupObject.userFields.gender="FEMALE"===e?"Female":"MALE"===e?"Male":"Other",i.validateAndSetDateOfBirth()},i.initialiseAddressObject=function(){i.signupObject.customFields.address=[],i.signupObject.customFields.address[0]={},i.signupObject.customFields.address[0].line=[]},i.initializeDefaultCountry=function(){i.signupDisplayFields.selectedCountry=s.getDefaultCountry(i.countriesList),i.signupDisplayFields.selectedCountry&&i.fetchStatesWrapper()},i.ALL="ALL",i.screenArrays=[],i.phoneNumberInvalid=!1,i.validations={phoneNumberInvalid:!1},i.isBirthdateInvalid=!1,i.confirmPassword=!0,i.genderList=[],u.serverConfig)?u.serverConfig.availableGenderListPatient.forEach((function(e){i.genderList.push(e.value)})):F.renderWithoutLoginConfigList().then((function(e){u.serverConfig=e.configList,u.serverConfig.availableGenderListPatient.forEach((function(e){i.genderList.push(e.value)}))}));function j(){i.configData.signUpProcess=g.loginType.toUpperCase(),t.extend(!0,i.signupObject.customFields,s.getFacebookUserData().customFields),i.signupObject.userFields.authProvider="facebook",i.configData.isAutoFillFacebookData&&i.addUserFieldsFromFacebookData(),console.log(i.signupObject)}function C(e){var t=i.configData.signUpScreenFlow[e];i.signupObject.signUpProcess=e,function(e,t){t===i.ALL?i.screenArrays.push(T(e[0])):e.forEach((function(e){i.screenArrays.push(T(e))}))}(t,e),i.maxStep=i.screenArrays.length}function T(e){return"INTERNAL"==e.type?"components/userSignUp/cards/"+e.template:"EXTERNAL"==e.type?"../themes/"+e.template:void 0}function P(e){i.currentStep=e,i.currentScreen=i.screenArrays[e],i.enableForm(),console.log(JSON.stringify(i.signupObject))}function N(e,t,n){return s.validateOTPForSignUp(e).success((function(e){e&&e.success&&(a.success(d("translate")("patientSignUp.otpVerification.otpVerified")),i.moveToNextStep())})).error((function(e){e&&0==e.success&&(i.errorMap=e.errors[0],i.isvalidateOtpForMobileDisable=!1),A(t,n)}))}function A(e,i){e&&i&&i.length>0&&(e[i].$setValidity("server",!1),t(".slimScrollDiv > div").animate({scrollTop:300},"500"))}i.currentStep=0,i.insuranceOption="IMAGE",i.pageSetUpSuccessFull=!0,i.authProvider="SELF",i.locationMap={},i.clearOtpField=!0,i.currentLanguage=O.get("langKey"),D=g.authProvider,U=g.loginType,D&&(i.authProvider=D,i.loginType=U),i.resetSignUpProcess=function(e){S(),Object.keys(s.getFacebookUserData()).length&&j(),P(0),e&&(i.signupObject.customFields.signUpType=e)},i.fetchSignupConfigs=function(){s.getSignUpConfig().success((function(e,n,r,a){i.configData=e,i.configData.passwordRegex=e.passwordRegex,function(){"saml"===g.loginType?s.samlFlowEnabled?(i.configData.signUpProcess=g.loginType.toUpperCase(),t.extend(!0,i.signupObject.userFields,s.getSamlUserData()),console.log(i.signupObject)):o.path("/auth"):"ldap"===g.loginType?s.ldapFlowEnabled?(i.configData.signUpProcess=g.loginType.toUpperCase(),t.extend(!0,i.signupObject.userFields,s.getLdapUserData()),console.log(i.signupObject)):o.path("/auth"):"facebook"===g.loginType?s.facebookFlowEnabled?("login"===o.search().actionFlow&&i.fbAccountNotFoundModal(),j()):(o.search({}),i.setSignUpCardActive()):"webseal"===g.loginType&&(s.websealFlowEnabled?(i.configData.signUpProcess=g.loginType.toUpperCase(),t.extend(!0,i.signupObject.userFields,s.getWebsealUserData()),console.log(i.signupObject)):(o.search({}),o.path("/websealAuth")));i.setSignUpCardActive()}(),i.configData.enableAutoLogin&&(i.signupObject.customFields.autoLogin=!0)})).error((function(e,t,s,n){i.pageSetUpSuccessFull=!1,i.pageSetUpErrorMessage=d("translate")("patientSignUp.serverError")}))},i.setSignUpType=function(e){e&&!i.signupObject.customFields.signUpType&&(i.signupObject.customFields.signUpType=e)},i.changeSignUpType=function(e){e&&(i.signupObject.customFields.signUpType=e)},i.setUserChosenSignUpProcessAndResetForm=function(e){var t=s.getActiveSignupProcess();t&&t!=e&&"ALL"!=e&&S(),i.setUserChosenSignUpProcess(e)},i.$watch("signupObject.signUpProcess",(function(e,t){s.setActiveSignupProcess(e)})),i.setUserChosenSignUpProcess=function(e,t){i.disableForm=!0,i.disableButton=!0,i.screenArrays.splice(1),C(e),P(null!=t&&null!=t?t+1:i.currentStep+1)},i.initializeNewFlow=function(e){S(),i.configData.signUpProcess=e,i.screenArrays=[],i.signupObject.customFields.signUpType&&(i.signupObject.customFields.signUpType=null),C(e),P(0)},i.concatAddress=function(){i.signupObject.customFields.address[0].text=s.concatAddressFields(i.signupObject.customFields.address[0]),i.signupObject.customFields.address[0].useCode="home"},i.moveToNextStep=function(){var e=i.currentStep+1;e>=i.screenArrays.length?i.registerUser():P(e)},i.moveToPreviousStep=function(){var e=i.currentStep-1;0!=e||i.configData.signUpProcess!=i.ALL&&i.configData.signUpProcess!="facebook".toUpperCase()?-1==e&&o.path("/auth"):(i.disableButton=!1,i.screenArrays.splice(1)),P(i.currentStep-1)},i.redirectToLoginPage=function(){o.path("/auth")},i.showHidePassword=function(e){var i=t(e.target),s=i.next("input");"password"===s.attr("type")?(s.attr("type","text"),i.removeClass("icon-show_password").addClass("icon-hide_password")):(s.attr("type","password"),i.removeClass("icon-hide_password").addClass("icon-show_password"))},i.sendOneTimePasswordForMobile=function(e,n){var o="",r="";if(i.phoneNumberValidation(e))return!1;if(""==i.clientConfiguration().phoneNumberMaskPattern){var c=t("#"+e);o=c.intlTelInput("getSelectedCountryData"),r=c.intlTelInput("getNumber")}return o="+"+o.dialCode,r=r.replace(o,""),i.signupObject.userFields.phoneNo=r,i.signupObject.userFields.countryCode=o,s.sendOneTimePassword({checkUser:!1!==n||n,phoneNumber:r,countryCode:o,source:"SELF_SIGN_UP_WEB"}).then((function(e){var t=e.data;if(t&&t.success)return a.success(d("translate")("patientSignUp.mobileVerification.optSentSuccessOnNewNumber",{phoneNo:i.signupObject.userFields.countryCode?i.signupObject.userFields.countryCode+d("maskPhoneNumber")(i.signupObject.userFields.phoneNo):d("maskPhoneNumber")(i.signupObject.userFields.phoneNo)})),!0;var s=t.info[0];return"MOSR65"===s.code?a.error(d("translate")("patientSignUp.optLimitReached")):"USR400"===s.code?a.error(d("translate")("patientSignUp.userAlreadyExisting")):"UV22"==s.code?a.error(d("translate")("patientSignUp.citizenNumber.userAlreadyExistsErrorMessage")):a.error(d("translate")("patientSignUp.mobileVerification.optSentError")),!1}))},i.resendOneTimePasswordForMobileWithoutValidation=function(){return s.sendOneTimePassword({checkUser:!0,phoneNumber:i.signupObject.userFields.phoneNo,countryCode:i.signupObject.userFields.countryCode,source:"SELF_SIGN_UP_WEB"}).then((function(e){var t=e.data;return t&&t.success?(a.success(d("translate")("patientSignUp.mobileVerification.optSentSuccess",{phoneNo:i.signupObject.userFields.countryCode?i.signupObject.userFields.countryCode+d("maskPhoneNumber")(i.signupObject.userFields.phoneNo):d("maskPhoneNumber")(i.signupObject.userFields.phoneNo)})),!0):("MOSR65"===t.info[0].code?a.success(d("translate")("patientSignUp.optLimitReached")):a.error(d("translate")("patientSignUp.mobileVerification.optSentError")),!1)}))},i.submitDemoGraphicForm=function(){i.disableForm=!0,i.moveToNextStep()},i.sendOneTimePasswordForEmail=function(){return s.sendOneTimePassword({checkUser:!0,email:i.signupObject.userFields.email,source:"SELF_SIGN_UP_WEB"}).then((function(e){if(e&&200==e.status){var t=e.data;if(t&&t.success)return a.success(d("translate")("patientSignUp.emailVerification.optSentSuccess",{emailId:i.signupObject.userFields.email})),!0;var s=e.data.info[0];return"MOSR64"===s.code?a.error(d("translate")("patientSignUp.optLimitReached")):"UV22"==s.code?a.error(d("translate")("patientSignUp.citizenNumber.userAlreadyExistsErrorMessage")):"USR400"===s.code?a.error(d("translate")("patientSignUp.userAlreadyExisting")):a.error(d("translate")("patientSignUp.mobileVerification.optSentError")),!1}return a.error(d("translate")("patientSignUp.emailVerification.optSentError")),!1}),(function(){return a.error(d("translate")("patientSignUp.emailVerification.optSentError")),!1}))},i.submitMobileInputScreen=function(e,t){i.isMobileInputDisable=!0,i.sendOneTimePasswordForMobile(e,t).then((function(e){e&&(i.clearOtpField=!0,i.moveToNextStep()),i.isMobileInputDisable=!1}))},i.resendOneTimePasswordForMobile=function(e,t,s,n){i.sendOneTimePasswordForMobile(e,n).then((function(e){e&&(i.signupObject.userFields.phoneOTP="",t.$setPristine(),i.removeServerErrorFromForm(t,s))}))},i.reSendOneTimePasswordForEmail=function(e,t){i.sendOneTimePasswordForEmail().then((function(s){s&&(i.signupObject.userFields.emailOTP="",e.$setPristine(),i.removeServerErrorFromForm(e,t))}))},i.submitEmailInputScreen=function(){i.isEmailInputDisable=!0,i.disableForm=!0,i.sendOneTimePasswordForEmail().then((function(e){e&&i.moveToNextStep(),i.enableForm(),i.isEmailInputDisable=!1}),(function(){i.enableForm(),i.isEmailInputDisable=!1}))},i.setVerifyingMobileNumber=function(e,i,s){i=i&&t.trim(i).length>0&&!i.startsWith("+")?"+"+i:i,e&&(e=i+e,setTimeout((function(){t("#"+s).intlTelInput("setNumber",e)}),0))},i.validateOtpForMobile=function(e,t,s,n,o){i.disableForm=!0,i.isvalidateOtpForMobileDisable=!0,N({phoneNumber:e,countryCode:t,otp:s,objectType:"mobile",source:"SELF_SIGN_UP_WEB"},n,o).then((function(e){i.isvalidateOtpForMobileDisable=!1,e.data.success&&(i.signupObject.userFields.isPhoneNoVerified=!0,i.clearOtpField=!1)}))},i.validateOtpForEmail=function(e,t,s,n){i.disableForm=!0,i.isvalidateOtpForEmailDisable=!0,N({email:e,otp:t,objectType:"email",source:"SELF_SIGN_UP_WEB"}).then((function(e){i.isvalidateOtpForEmailDisable=!1,i.enableForm(),e.data.info[0].status?(i.signupObject.userFields.isEmailVerified=!0,f.raiseEvent({name:"SIGNUP_VALIDATE_EMAIL_OTP_SUCCESS",data:{}})):A(s,n)}),(function(){i.enableForm(),A(s,n),i.isvalidateOtpForEmailDisable=!1}))},i.submitCurrentScreen=function(e){e().success((function(e){e&&i.moveToNextStep()}))},i.checkNumber=function(e){e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105||13!=e.keyCode&&46!=e.keyCode&&8!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&9!=e.keyCode&&e.preventDefault()},i.setDisplayPhoneNumber=function(e){i.signupDisplayFields.phoneNoToDisplay=e.$viewValue},i.phoneNumberValidation=function(e){var s=t("#"+e);return i.signupObject.userFields.countryCode=s.intlTelInput("getSelectedCountryData"),i.signupObject.userFields.phoneNo=s.intlTelInput("getNumber"),i.signupObject.userFields.countryCode="+"+i.signupObject.userFields.countryCode.dialCode,i.signupObject.userFields.phoneNo=i.signupObject.userFields.phoneNo.replace(i.signupObject.userFields.countryCode,""),0==y.customPhoneValidator(s)||0==i.signupObject.userFields.phoneNo.length?(i.validations.phoneNumberInvalid=!0,i.phoneNumberInvalid=!0):(i.validations.phoneNumberInvalid=!1,i.phoneNumberInvalid=!1),i.phoneNumberInvalid},i.emergencyContactValidation=function(e){var s=t("#"+e);return i.signupObject.customFields.emergencyContact.countryCode=s.intlTelInput("getSelectedCountryData"),i.signupObject.customFields.emergencyContact.phone=s.intlTelInput("getNumber"),i.signupObject.customFields.emergencyContact.countryCode="+"+i.signupObject.customFields.emergencyContact.countryCode.dialCode,i.signupObject.customFields.emergencyContact.phone=i.signupObject.customFields.emergencyContact.phone.replace(i.signupObject.customFields.emergencyContact.countryCode,""),0==y.customPhoneValidator(s)||0==i.signupObject.customFields.emergencyContact.phone.length?i.phoneNumberInvalid=!0:i.phoneNumberInvalid=!1,i.phoneNumberInvalid},i.validateDateOfBirth=function(e){return moment(e).isBefore(i.minDate)?(i.signupDisplayFields.invalidDateRange=!0,void(i.isBirthdateInvalid=!1)):(i.signupDisplayFields.invalidDateRange=!1,e&&t.trim(e)?s.validateDateOfBirth({dob:d("convertDobToUTC")(e)}).then((function(e){var t=e.data;return i.isBirthdateInvalid="VDOB63"!=t.info[0].code}),(function(e){return!1})):void 0)},i.validateDateOfBirthAndFireMethod=function(e,t,s){var n=this;i.validateDateOfBirth(e).then((function(e){e||t.apply(n,s)}),(function(e){}))},i.validateAndSetDateOfBirth=function(){i.signupDisplayFields.dobToDisplay&&t.trim(i.signupDisplayFields.dobToDisplay)?s.validateDateOfBirth({dob:d("convertDobToUTC")(i.signupDisplayFields.dobToDisplay)}).success((function(e,t,s,n){"VDOB63"!==e.info[0].code?i.isBirthdateInvalid=!0:(i.isBirthdateInvalid=!1,i.signupObject.userFields.dob=d("convertDobToUTC")(i.signupDisplayFields.dobToDisplay)),i.signupDisplayFields.isDobValidated=!0})):(i.isBirthdateInvalid=!1,i.signupDisplayFields.isDobValidated=!0)},i.registerUser=function(){i.disableForm=!0,i.signupObject&&i.signupObject.customFields&&i.signupObject.customFields.confirmPassword&&delete i.signupObject.customFields.confirmPassword,s.registerUser(i.signupObject).success((function(t,n,r,a){i.enableForm();try{if(200==n){f.raiseEvent({name:"SIGNUP_SUCCESS",data:{}}),i.configData.enableAutoLogin&&s.setLoginResponse(t);var c="";if(s.ldapFlowEnabled)c="ldap/"+(u=i.signupObject.userFields.username).replace("_"+i.authProvider,"");else if(s.samlFlowEnabled){c="saml/"+(u=i.signupObject.userFields.username).replace("_"+i.authProvider,"")}else if(s.facebookFlowEnabled){var u;c="facebook/",c+=(u=i.signupObject.userFields.username)?u.replace("_"+i.authProvider,""):Math.floor(10*Math.random()+1)}else s.websealFlowEnabled?E(s.loginResponse):(t.successHandler&&s.setSignUpSuccessUriData(t.successHandler),c="accountReady");if(e.openAuthenticationContainer)return void(e.processTemplatePath="components/userSignUp/cards/registerSuccessfulModal.html");s.websealFlowEnabled||o.path("/registerSuccess/"+c)}}catch(e){console.log("error occured post successful response."),i.enableForm()}})).error((function(e){a.error(d("translate")("patientSignUp.saveUser.errorMessage")),i.enableForm()}))},i.submitUserPassword=function(){i.disableForm=!0,i.moveToNextStep()},i.validateThirdPartyUid=function(e,t){return i.userAlreadyExists=!1,s.validateThirdPartyUid(e).then((function(e){var s=e.data;s&&s.success?((e=s.info[0]).contactType&&"EMAIL"===e.contactType.toUpperCase()?(i.signupObject.userFields.email=e.value,i.signupObject.customFields.contactType=e.contactType,e.isVerifiedContact&&(i.signupObject.userFields.isEmailVerified=!0)):e.contactType&&"MOBILE"===e.contactType.toUpperCase()&&(i.signupObject.userFields.phoneNo=e.value,i.signupObject.customFields.contactType=e.contactType,i.signupObject.userFields.countryCode=e.countryCode,e.isVerifiedContact&&(i.signupObject.userFields.isPhoneNoVerified=!0)),i.searchMap=e.searchMap,e.sendOtpAfterUidValidation&&function(e){"MOSR64"===e.code||"MOSR65"===e.code?a.error(d("translate")("patientSignUp.optLimitReached")):e.contactType&&"mobile"===e.contactType.toLowerCase()?i.signupObject.userFields.phoneNo&&0!=i.signupObject.userFields.phoneNo.trim().length?a.success(d("translate")("patientSignUp.mobileVerification.optSentSuccess",{phoneNo:i.signupObject.userFields.countryCode?i.signupObject.userFields.countryCode+d("maskPhoneNumber")(i.signupObject.userFields.phoneNo):d("maskPhoneNumber")(i.signupObject.userFields.phoneNo)})):a.success(d("translate")("patientSignUp.mobileVerification.noMobileNumberFound")):e.contactType&&"email"===e.contactType.toLowerCase()&&(i.signupObject.userFields.email&&0!=i.signupObject.userFields.email.trim().length?a.success(d("translate")("patientSignUp.emailVerification.optSentSuccess",{emailId:i.signupObject.userFields.email})):a.success(d("translate")("patientSignUp.mobileVerification.noEmailFound")))}(e)):"67"==s.info[0].code&&t||(i.errorMap=s.info[0]);return s}),(function(e){e.status?a.error(d("translate")("httpErrors."+e.status)):a.error(d("translate")("patientSignUp.citizenNumber.validationErrorMessage"))}))},i.submitThirdPartyUidForm=function(e,t,s,n,o){console.log("\requestData.maxId=========="+e.maxId),console.log(i.signupObject),console.log("requestData.fieldName=========="+e.fieldName),i.disableForm=!0,null==n&&(n=!0),n||(i.signupObject.userFields.phoneOTP=null,t&&(t.$setPristine(),t.$setUntouched())),f.raiseEvent({name:"SIGNUP_VALIDATE_THIRD_PARTY",data:{requestData:e}}),i.validateThirdPartyUid(e,o).then((function(r){r&&r.success?(null!=e.otp&&""!=e.otp&&window.dataLayer&&f.raiseEvent({name:"SIGNUP_VALIDATE_THIRD_PARTY_SUCCESS",data:{}}),n&&(i.searchMap&&i.searchMap.switchProcess&&o?i.setUserChosenSignUpProcess(o.process,o.stepNumber):i.moveToNextStep())):(r&&0==r.success&&(i.errorMap=r.info[0]),r&&r.info&&"67"==r.info[0].code&&o&&o?i.submitMobileInputScreen("sup_mobile_input",!1):A(t,s)),i.enableForm()}),(function(){i.enableForm()}))},i.convertDOBToUTC=function(e){return e?d("convertDobToUTC")(e):""},i.prepopulateUserDetails=function(e){i.configData.populateUserDetails&&s.fetchUserDetails(e).success((function(e){e&&e.success&&(e.info[0].userDetails&&(t.extend(!0,i.signupObject,e.info[0].userDetails),i.signupDisplayFields&&(i.signupDisplayFields.dob=d("convertToCalendarDateObject")(i.signupObject.userFields.dob))))})).error((function(){}))},i.searchUserAndOverrideDetailsIfPresent=function(e,n,o){i.disableForm=!0,s.fetchUserDetails(e).success((function(e){i.enableForm();try{e&&e.success?(e.info[0].userDetails&&e.info[0].userDetails.userFields&&Object.keys(e.info[0].userDetails.userFields).length>0&&(t.extend(!0,i.signupObject,e.info[0].userDetails),i.signupDisplayFields&&(i.signupDisplayFields.dob=d("convertToCalendarDateObject")(i.signupObject.userFields.dob)),a.success(d("translate")("patientSignUp.thirdPartyVerification.newUserFlowPatientFound"))),i.moveToNextStep()):(i.errorMap=e.info[0],A(n,o))}catch(e){i.enableForm()}})).error((function(){i.enableForm()}))},i.verifyOneTimePasswordAndFetchUserDetails=function(e,n,o){i.isvalidateOtpForMobileDisable=!0,i.configData.populateUserDetails&&s.verifyOneTimePasswordAndFetchUserDetails(e).success((function(e){(i.isvalidateOtpForMobileDisable=!1,e&&e.success)?(i.signupObject.userFields.isPhoneNoVerified=!0,a.success(d("translate")("patientSignUp.otpVerification.otpVerified")),e.info[0].userDetails&&t.extend(!0,i.signupObject,e.info[0].userDetails),i.moveToNextStep()):A(n,o)})).error((function(e){i.isvalidateOtpForMobileDisable=!1,e&&e.errors&&(i.errorMap=e.errors[0]),A(n,o)}))},i.displayPicture=function(e,t){if(i[t+"Obj"]){i.$apply((function(){i[t]=!0}));var s=i[t+"Obj"],n=document.querySelector("#"+e),o=new FileReader;o.onloadend=function(){switch(t){case"profilePicUploaded":i.signupObject.customFields.userProfilePicture=o.result.split(",")[1],i.signupObject.customFields.userProfilePictureMimeType=i[t+"Obj"].type;break;case"ins_front_image_uploaded":i.signupObject.customFields.coverage||(i.signupObject.customFields.coverage={}),i.signupObject.customFields.coverage.insuranceType="image",i.signupObject.customFields.coverage.frontImage=o.result.split(",")[1],i.signupObject.customFields.coverage.frontImageMimeType=i[t+"Obj"].type;break;case"ins_back_image_uploaded":i.signupObject.customFields.coverage||(i.signupObject.customFields.coverage={}),i.signupObject.customFields.coverage.insuranceType="image",i.signupObject.customFields.coverage.backImage=o.result.split(",")[1],i.signupObject.customFields.coverage.backImageMimeType=i[t+"Obj"].type}n.src=o.result},s?o.readAsDataURL(s):n.src=""}else i[t]=void 0},i.previewFiles=function(e,t,s){i[s+"_sizeError"]=!1;var n=document.querySelector("."+e+" input[type=file]").files[0];if(n.size>u.patientSignUp.maxPicSize[s])return i.$apply((function(){i[s+"_sizeError"]=!0,i[s]=!1})),document.querySelector("#"+t).src="",void(document.querySelector("."+e+" input[type=file]").value="");i[s+"Obj"]=n,i.displayPicture(t,s)},i.removeSelectedPicture=function(e,t,s){switch(i[s]=!1,s){case"profilePicUploaded":i.signupObject.customFields.userProfilePicture=null,i.signupObject.customFields.userProfilePictureMimeType=null}document.querySelector("#"+t).src="",document.querySelector("."+e+" input[type=file]").value=""},i.populateInsuranceOptions=function(){i.insuranceOptions||(i.insuranceOptions=["medicare","medicaid","private"])},i.isValidInsuranceForm=function(e){var i=!0;switch(t('input[name="'+e+'"]:checked').val()){case"MANUAL":i=!0}return i},i.skipInsuranceForm=function(){i.ins_front_image_uploadedObj&&(i.ins_front_image_uploadedObj=null),i.ins_back_image_uploadedObj&&(i.ins_back_image_uploadedObj=null),i.signupObject.customFields.coverage={},i.moveToNextStep()},i.selectInsuranceDetailOption=function(e){var s=e.currentTarget;i.insuranceOption=t(s).val(),i.signupObject.customFields.coverage={}},i.passwordIsStrongEnough=!0,i.checkForPasswordStrength=function(e){Math.round(e/33)>=parseInt(u.passwordStrengthLevel)?i.passwordIsStrongEnough=!0:i.passwordIsStrongEnough=!1},i.verifierDetails=function(){g.verifierType&&g.verifierKey?"ldap"==g.verifierType?(i.isLdapAccount=!0,i.ldapUserName=g.verifierKey):"saml"==g.verifierType?(i.isSamlAccount=!0,i.samlUserName=g.verifierKey):"facebook"==g.verifierType&&(i.isFacebookAccount=!0,i.facebookIdentifier=g.verifierKey):i.successObj=s.getSignUpSuccessUriData()},i.removeServerErrorFromForm=function(e,t){e[t].$setValidity("server",!0)},i.redirectAfterSignUp=function(){if(s.loginResponse&&Object.keys(s.loginResponse).length>0){if(e.openAuthenticationContainer)return r.set("x-auth-token",s.loginResponse.token),i.closeCustomModal(),c.getUserDetails(!1),c.getConfigList(s.loginResponse.token),c.getVitalConfig(s.loginResponse.token),void i.$emit("saveAppointmentObj",{});E(s.loginResponse)}else{e.loginType=u.signInOptionAllowed.defaultSignIn,e.authProvider="",o.path(u.redirectedUrlAfterSignUp);u.redirectedUrlAfterSignUp;o.path(u.redirectedUrlAfterSignUp)}};var E=function(e){if(i.username=e.username,"ERE404"===e.requiredPreequisite)return o.search({}),b.setAuthToken(e.token),o.path("/recoveryViaEmail"),!1;c.fetchUserAgreements(e.token,O.get("langKey")).success((function(){if(null!=c.getUserCookie("userAgreements").userAgreements&&c.getUserCookie("userAgreements").userAgreements.length>0||1==c.getUserCookie("incorrectUserAgreements"))return c.setUserCookie("agreementType",d("findAgreementType")(e.roles)),b.setAuthToken(e.token),o.path("/agreement"),c.setUserCookie("preAgreementLogin",i.username),!1;(e.firstLogin||e.passwordExpired)&&"SELF_SIGN_UP_WEB"!=e.signUpSource&&"ldap"!=O.get("loginType")?o.path("/firstLoginChangePassword/"+e.token):(c.setUserCookie("x-auth-token",e.token),c.getConfigList(e.token),c.getVitalConfig(e.token),c.getUserDetails(!0))})).error((function(){}))};i.initFullRegistration=function(){console.log("init full"),i.initialiseAddressObject(),i.fetchCountries(),e.configPromise.promise.then((function(){var e=u.serverConfig.contactRelationList;i.relationshipList=[],Object.keys(e).forEach((function(e){i.relationshipList.push({value:e,text:d("translate")("emergencyContactRelationshipTypes.value."+e)})}))}))},i.fetchCountries=function(){var e=s.createCustomHeaderForRequestWithVersion("V1"),t={lang:h.getCurrentLanguage()};p.postHTTP(u.baseURL+"/moCountryDropDown/fetchCountries",t,!1,e).success((function(e){e.success&&(i.countriesList=e.countries)}),(function(e){a.error(d("translate")("patientSignUp.serverError"))}))},i.fetchStatesWrapper=function(){i.statesList=[],i.citiesList=[],i.signupDisplayFields.selectedState=null,i.signupDisplayFields.selectedCity=null;var e={};i.signupDisplayFields.selectedCountry&&i.signupDisplayFields.selectedCountry.id&&(u.serverConfig&&u.serverConfig.zipcodeRegex?i.zipcodeRegex=u.serverConfig.zipcodeRegex[i.signupDisplayFields.selectedCountry.name]:i.configData&&i.configData.zipcodeRegex&&(i.zipcodeRegex=i.configData.zipcodeRegex[i.signupDisplayFields.selectedCountry.name]),e.countryId=i.signupDisplayFields.selectedCountry.id,function(e){if(!e.countryId)return;var t=s.createCustomHeaderForRequestWithVersion("V1");e.lang=h.getCurrentLanguage(),p.postHTTP(u.baseURL+"/moCountryDropDown/fetchStates",e,!1,t).success((function(e){e.success&&(i.statesList=e.states)}),(function(e){a.error(d("translate")("patientSignUp.serverError"))}))}(e))},i.fetchCitiesWrapper=function(){i.citiesList=[],i.signupDisplayFields.selectedCity=null;var e={};i.signupDisplayFields.selectedState&&i.signupDisplayFields.selectedState.id&&(e.stateId=i.signupDisplayFields.selectedState.id,function(e){if(!e.stateId)return;e.lang=h.getCurrentLanguage(),s.fetchCities(e,"V1").then((function(e){e.cities&&e.cities.length>0&&(i.citiesList=e.cities)}),(function(e){a.error(d("translate")("patientSignUp.serverError"))}))}(e))},i.extractAddressInfo=function(){var e={url:"SearchTag",value:[]};i.signupObject.customFields.extension=[],i.signupDisplayFields.selectedCountry&&(i.signupObject.customFields.address[0].country=i.signupDisplayFields.selectedCountry.code),i.signupDisplayFields.selectedState&&(i.signupObject.customFields.address[0].state=i.signupDisplayFields.selectedState.code),i.signupDisplayFields.selectedCity&&(i.signupObject.customFields.address[0].city=i.signupDisplayFields.selectedCity.code),i.signupDisplayFields.passportIssueCountry&&i.signupObject.customFields.passportDetails.passportNo&&(i.signupObject.customFields.passportDetails.passportIssuingAuthority=i.signupDisplayFields.passportIssueCountry.code),i.signupDisplayFields.nationality&&e.value.push({patientNationality:i.signupDisplayFields.nationality.code}),i.appointmentDetail&&i.appointmentDetail.appointment&&i.appointmentDetail.appointment.location&&i.appointmentDetail.appointment.location.identifier&&(i.signupObject.locationCode=i.appointmentDetail.appointment.location.identifier),i.appointmentDetail&&i.appointmentDetail.appointment&&i.appointmentDetail.appointment.id&&(i.signupObject.appointmentId=i.appointmentDetail.appointment.id),i.signupDisplayFields.patientRace&&(e.value[0]?e.value[0].race=i.signupDisplayFields.patientRace:e.value.push({race:i.signupDisplayFields.patientRace})),e.value.length>0&&i.signupObject.customFields.extension.push(e)},i.clearPassportDetails=function(){i.signupObject.customFields.passportDetails={}},i.clearAadharDetails=function(){i.signupObject.customFields.aadharNo=null},i.fullRegistration=function(){i.extractAddressInfo(),i.addCountryAndStateAndCityNameToAddressObject(),i.concatAddress(),i.signupObject.userFields={},function(){console.log(i.signupObject);var e=s.createCustomHeaderForRequestWithVersion("V1");p.postHTTP(u.baseURL+"/moPatient/generatePatientIdFromThirdParty",i.signupObject,!0,e).success((function(e){if("success"==e.status){i.hideFullRegistrationForm=!0;var t={identifierAttributes:e.patientId[0].value,identifierSystem:e.patientId[0].system,identifierTypeText:e.patientId[0].type.text};i.appointmentDetail.appointment.patient.patientIdentifiers.push(t),i.hospitalLocation=e.patientId[0].system,i.hospitalLocationName=d("translate")("patientLinking.list.hospitalLocation."+i.hospitalLocation)}})).error((function(){a.error(d("translate")("CA.registration.fullRegistration.fullRegistrationError"))}))}()},i.addCountryAndStateAndCityNameToAddressObject=function(){i.signupDisplayFields.selectedCountry&&i.signupDisplayFields.selectedCountry.code&&(i.signupObject.customFields.address[0].countryName=i.signupDisplayFields.selectedCountry.name),i.signupDisplayFields.selectedState&&i.signupDisplayFields.selectedState.code&&(i.signupObject.customFields.address[0].stateName=i.signupDisplayFields.selectedState.name)},i.closeAuthenticationContainerPopup=function(t){e.processTemplatePath="components/login/authModal.html",i.closeCustomModal(),v.reload()},i.fetchLocations=function(){s.fetchPhysicalLocations().then((function(e){i.locationMap=e}),(function(e){a.error(d("translate")("patientSignUp.ICNumber.location.fetchError")),i.locationMap=e}))},i.validateAgainstMinDate=function(e,i,s){if(e&&t.trim(e))return e<s.startOf("day")},i.fetchRaceList=function(e){var t=u.serverConfig.patientRaceList;i.patientRaceList=[],Object.keys(t).forEach((function(e){i.patientRaceList.push({value:e,text:d("translate")("race."+e)})}))},i.fbAccountNotFoundModal=function(){l.open({templateUrl:"components/userSignUp/fbAccountNotFound.html",controller:"ModalInstanceCtrl",scope:i,size:"sm",resolve:{}})},i.isModalModeOn=function(){return e.openAuthenticationContainer},i.signUpInstructionModal=function(){var e=u.patientSignUp.instructionFilePath;l.open({templateUrl:e,controller:"ModalInstanceCtrl",scope:i,size:"md",resolve:{}})},i.getLanguageOptionsList=function(){if(!i.signupObject.userFields.languageOptions){var e=[];e.push({displayName:"English",languageCode:"en"}),e.push({displayName:"Thai",languageCode:"th"}),i.signupObject.userFields.languageOptions=e}},i.enableForm=function(){setTimeout((function(){i.disableForm=!1}),100)}}]).controller("ModalInstanceCtrl",["$scope","$modalInstance","ConfigurationHolder",function(e,t,i){e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")},e.fetchRaceList=function(t){e.patientRaceList=i.serverConfig.patientRaceList}}])}).call(this,i(1))}}]);